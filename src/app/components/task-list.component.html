<!-- src/app/components/task-list.component.html -->
<ion-content class="ion-padding task-content">

  <!-- Header + Add Button -->
  <div class="header-row">
    <h2 class="section-title">Tasks List</h2>
    <ion-button class="toggle-btn" fill="outline" color="primary" (click)="toggleAdd()">
      <ion-icon slot="start" [name]="isAdding ? 'close' : 'add-outline'"></ion-icon>
      {{ isAdding ? 'Ã— Cancel' : '+ Add Task' }}
    </ion-button>
  </div>

  <!-- Add/Edit Task Form -->
  <div #formContainer>
    <ion-card *ngIf="isAdding" class="add-card">
      <ion-card-header>
        <ion-card-title>
          {{ editingTask ? 'Edit Task' : 'Add New Task' }}
        </ion-card-title>
      </ion-card-header>

      <ion-card-content [formGroup]="taskForm">
        <ion-item>
          <ion-label position="stacked">Subject</ion-label>
          <ion-input
            formControlName="subject"
            placeholder="Enter task subject">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Deadline</ion-label>
          <ion-input
            formControlName="deadline"
            type="date"
            [min]="minDate">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Status</ion-label>
          <ion-select formControlName="status">
            <ion-select-option value="not started">Not Started</ion-select-option>
            <ion-select-option value="in progress">In Progress</ion-select-option>
            <ion-select-option value="completed">Completed</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-button expand="block" class="add-btn" (click)="addTask()">
          {{ editingTask ? 'Update Task' : 'Add Task' }}
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>


  <!-- Task List -->
  <ion-list *ngIf="tasks$ | async as tasks; else noTasks" class="task-list">
    <div *ngFor="let task of tasks" class="task-row">
      <!-- Left: Date Card -->
      <ion-card class="date-card">
        <ion-card-content>
          <h2>{{ task.deadline | date:'dd' }}</h2>
          <p>{{ task.deadline | date:'MMM' }}</p>
        </ion-card-content>
      </ion-card>

      <!-- Right: Task Detail Card -->
  <ion-card
    class="task-card"
    [ngClass]="{ 'completed-task': task.status === 'completed' }"
  >
    <ion-card-content>
      <div class="task-header">
        <div class="task-title">
          <h3>{{ task.subject }}</h3>
          <p class="task-deadline">Due: {{ task.deadline | date:'longDate' }}</p>
        </div>

        <span
          class="status-badge"
          [ngClass]="{
            'completed': task.status === 'completed',
            'in-progress': task.status === 'in progress',
            'not-started': task.status === 'not started'
          }"
        >
          {{ task.status | titlecase }}
        </span>
      </div>

      <div class="task-footer">
        <ion-select
          [value]="task.status"
          (ionChange)="updateStatus(task, $event)"
          interface="popover"
          placeholder="Change Status"
        >
          <ion-select-option value="not started">Not Started</ion-select-option>
          <ion-select-option value="in progress">In Progress</ion-select-option>
          <ion-select-option value="completed">Completed</ion-select-option>
        </ion-select>

        <div class="action-buttons">
          <ion-button class="edit-btn" fill="solid" size="small" (click)="editTask(task)">
            <ion-icon name="create-outline" slot="start"></ion-icon>
            Edit
          </ion-button>

          <ion-button class="delete-btn" fill="solid" size="small" (click)="deleteTask(task)">
            <ion-icon name="trash-outline" slot="start"></ion-icon>
            Delete
          </ion-button>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

    </div>
  </ion-list>


  <ng-template #noTasks>
    <ion-text color="medium">
      <p class="no-task-text">No tasks yet. Add one above!</p>
    </ion-text>
  </ng-template>
</ion-content>


